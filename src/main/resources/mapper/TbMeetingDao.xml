<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zf.emos.wx.db.dao.TbMeetingDao">
  <insert id="insertMeeting" parameterType="com.zf.emos.wx.db.pojo.TbMeeting">
    INSERT INTO tb_meeting SET
    uuid = #{uuid} ,
    title = #{title} ,
    creator_id = #{creatorId},
    date = #{date} ,
    <if test="place != null">
      place = #{place} ,
    </if>
    start = #{start} ,
    end = #{end} ,
    type = #{type} ,
    members = #{members} ,
    `desc` = #{desc} ,
    instance_id = #{instanceId},
    status = #{status},
    create_time = #{createTime}
  </insert>
  <select id="searchMyMeetingListByPage" parameterType="hashmap" resultType="hashmap">
    SELECT
		 m.id,
		 m.uuid,
		 m.title,
		 u2.name,
		 DATE_FORMAT(m.date,'%Y年%m月%d日') AS date,
		 m.place,
		 DATE_FORMAT(m.start,'%H:%i') AS start,
		 DATE_FORMAT(m.end,'%H:%i') AS end ,
		 m.type,
		 m.status,
		 m.desc,
		 u2.photo,
		 TIMESTAMPDIFF(HOUR,CONCAT(m.date," ",m.start),CONCAT(m.date," ",m.end)) AS HOUR
    FROM tb_meeting m
    JOIN tb_user u1 ON JSON_CONTAINS(m.members, CAST(u1.id AS CHAR))
    JOIN tb_user u2 ON m.creator_id = u2.id
    WHERE u1.id = #{userId} AND m.status IN (3,4)
            AND u1.status = 1 AND u2.status = 1
    ORDER BY m.date , m.start , m.id
    LIMIT #{start} , #{length}
  </select>
</mapper>